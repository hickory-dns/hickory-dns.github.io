<!DOCTYPE HTML>
<html lang="en" class="dark sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Authoritative Name server - Hickory DNS User Manual</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../mdbook.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "dark";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('dark')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Hickory DNS User Manual</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/hickory-dns/hickory-dns.github.io/tree/main/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="authoritative-name-server"><a class="header" href="#authoritative-name-server">Authoritative Name server</a></h1>
<p>One of the roles Hickory supports is as an <a href="https://en.wikipedia.org/wiki/Name_server#Authoritative_name_server">authoritative name server</a>.
This type of name server has authoritty over its own zones and can answer queries for which it is responsible.</p>
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<p>To configure Hickory as an authoritative name server the setup requires a few steps.</p>
<ul>
<li>set up one or more zone files to have authority over</li>
<li>generate a zone signing key (ZSK)</li>
<li>configure Hickory to define zones and key</li>
</ul>
<h3 id="zone-files"><a class="header" href="#zone-files">Zone File(s)</a></h3>
<p>First at least one zone file has to be created, Hickory has the authority over. An example of a zone file (e.g. <code>root.zone</code>) looks as follows:</p>
<pre><code class="language-txt">.	86400	IN	SOA	primary0.example.com. admin0.example.com. 2024010101 1800 900 604800 86400
.	86400	IN	NS	primary0.example.com.
primary0.example.com.	86400	IN	A	127.0.0.1
</code></pre>
<p>This file defines a <code>SOA</code> record (Start of Authority), a <code>NS</code> record (Namespace) and an <code>A</code> record (IPv4 Address).</p>
<p>A list of zone file examples can be found in the <a href="https://github.com/hickory-dns/hickory-dns/tree/main/tests/test-data/test_configs/default"><code>test_configs/default</code></a> folder as part of Hickory's test suite.</p>
<h3 id="zone-signing-key"><a class="header" href="#zone-signing-key">Zone Signing Key</a></h3>
<p>The second step is to generate a zone signing key (ZSK). Hickory will use this key to sign all zones with during startup.
Additionally a key signing key is generated as well internally.</p>
<p>To generate a compatible ZSK we use the <code>openssl</code> command line tool:</p>
<pre><code class="language-shell">openssl genpkey -quiet -algorithm RSA -out zsk.key
</code></pre>
<p>This generates a new key using the <code>RSASHA256</code> algorithm and stores the private key in <code>zsk.key</code>.</p>
<blockquote>
<p><strong>Note:</strong> Other tools to generate keys exist, but not all key formats are currently supported by Hickory.</p>
</blockquote>
<h3 id="configtoml"><a class="header" href="#configtoml"><code>config.toml</code></a></h3>
<p>The last step is to create a <code>config.toml</code> file for Hickory.</p>
<pre><code class="language-toml"># config.toml
listen_addrs_ipv4 = ["0.0.0.0"]

[[zones]]
zone = "."
zone_type = "Primary"
file = "root.zone"
enable_dnssec = true

[[zones.keys]]
key_path = "zsk.key"
algorithm = "RSASHA256"
is_zone_signing_key = true
</code></pre>
<p>This configuration consists of the following fields:</p>
<ul>
<li><code>listen_addrs_ipv4</code> - specifies the list of addresses the DNS server will accept connections on.</li>
<li><code>[[zones]]</code> - A block to define a zone.
<ul>
<li><code>zone</code> - The zone to sign, in this case root <code>"."</code>.</li>
<li><code>zone_type</code> - <code>Primary</code> indicates that hickory is the authority.</li>
<li><code>file</code> - The name of the zone file that contains all DNS records.</li>
<li><code>enable_dnssec</code> - When <code>true</code> Hickory generates additional DNSSEC records for all records in the zone file on startup.</li>
</ul>
</li>
<li><code>[[zones.keys]]</code> - A block to define a zone key.
<ul>
<li><code>key_path</code> - The path to the signing key, e.g. <code>zsk.key</code></li>
<li><code>algorithm</code> - The cryptographic algorithm the key was generated with.</li>
<li><code>is_zone_signing_key</code> - When <code>true</code> marks the key as zone signing key.</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Important:</strong> The flag  <code>enable_dnssec</code> in this context does not mean DNSSEC validation is active, it's used to generate all relevant DNSSEC records during startup.</p>
</blockquote>
<p>Multiple zones can be specified by repeated <code>[[zones]]</code> blocks that point to separate zone files.</p>
<h2 id="run-hickory"><a class="header" href="#run-hickory">Run Hickory</a></h2>
<p>Let's start <code>hickory-dns</code> now, we assume zone file(s), ZSK and <code>config.toml</code> are all in the same folder.</p>
<pre><code class="language-shell">hickory-dns --port 2345 --debug --config=./config.toml --zone-dir=.
</code></pre>
<p>This starts <code>hickory-dns</code> on port <code>2345</code> with debug log level. Feel free to pick a different port, typically port <code>53</code> is already
taken by the DNS service of the operating system. The <code>--config</code> option specifies the location of the <code>config.toml</code>
otherwise it checks the default file path at <code>/etc/named.toml</code>. The <code>--zone-dir</code> option specifies the path to check zone
files in, e.g. to find <code>root.zone</code>, the default directoy is <code>/var/named</code>.</p>
<p>The debug log of Hickory should contain output that loads a <code>ZoneConfig</code>, the authority loads zone records and signs the
zone <code>"."</code> using the generated zone signing key. The <code>hickory-dns</code> server should now run and accept DNS queries,
for example via <code>dig</code> or <code>delv</code>.</p>
<h2 id="querying-records"><a class="header" href="#querying-records">Querying Records</a></h2>
<p>To fetch the <code>A</code> record for domain <code>primary0.example.com.</code> use the <code>dig</code> command:</p>
<pre><code class="language-shell">dig @127.0.0.1 -p 2345 primary0.example.com. +norecurse
</code></pre>
<p>which returns</p>
<pre><code class="language-txt">; &lt;&lt;&gt;&gt; DiG 9.20.2 &lt;&lt;&gt;&gt; @127.0.0.1 -p 2345 primary0.example.com. +norecurse
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 39369
;; flags: qr aa; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags: do; udp: 1232
; OPT=5: 08 0d 0e 0f ("....")
; OPT=6: 08 0d 0e 0f ("....")
;; QUESTION SECTION:
;primary0.example.com.	IN	A

;; ANSWER SECTION:
primary0.example.com. 86400 IN	A	127.0.0.1

;; Query time: 0 msec
;; SERVER: 127.0.0.1#2345(127.0.0.1) (UDP)
;; WHEN: Mon Oct 21 15:15:19 CEST 2024
;; MSG SIZE  rcvd: 117
</code></pre>
<blockquote>
<p><strong>Note:</strong> The authoritative name server is configured to not send queries to other servers, therefore the <code>+norecurse</code> option is passed in.</p>
</blockquote>
<p>The following lines provide a bit more information on the response.</p>
<pre><code class="language-txt">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 39369
;; flags: qr aa; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1
</code></pre>
<p>The DNS server responded with status <code>NOERROR</code>, indicating a valid response. The <code>flags</code> field is a bitset with
different flags, displayed as <code>qr aa</code>.</p>
<ul>
<li><code>qr</code> - means it's a query response</li>
<li><code>aa</code> - means it's an authoritative answer</li>
<li><code>rd</code> - (when given) means recursion desired, the name server is allowed to forward the query to other upstream name servers</li>
</ul>
<p>The <code>dig</code> CLI sets the <code>+recurse</code> flag as default, therefore the <code>rd</code> flag will appear in the response if not deactivated.</p>
<p>In order to check that the DNS server created the associated <code>RRSIG</code> record to the <code>A</code> record, use <code>dig</code>'s <code>+dnssec</code>
option to return both records.</p>
<pre><code class="language-shell">dig @127.0.0.1 -p 2345 primary0.example.com. +dnssec +multiline
</code></pre>
<p>The <code>+multiline</code> option will wrap the text to a reasonable width.
This will return the associated <code>RRSIG</code> record in the <code>ANSWERS</code> section as well.</p>
<pre><code class="language-txt">;; ANSWER SECTION:
primary0.example.com. 86400 IN A 127.0.0.1
primary0.example.com. 86400 IN RRSIG A 8 3 86400 (
				20251020134506 20241021134506 57797 .
				FyZW3yHIdEfN0eakLvgsZQkzx5MhcLM24h8wNPiEcosX
				3TTOr0NwvXAHqtbxYTJssfjR3DZhG3EgBdlZ18FpBKoY
				+VA3Vg+NYtuKpGduXU7Dreh3La5L8GlKC6uFc1ay0hR6
				qTq8M07JyzlMWE+U6r1n2R9bATKiWufhuDtnoINJbDMi
				TwaJ/ZxE7lfttpQ1gUKoNoEcOGkZUP18JlnyXoKrNkVH
				DdD0J/K8LTp/lnZ7AuAQ7ixJRNxroth6meeCHAQHNqyL
				9H6zKAiSRw4RVi4swodhyzCzn+oXhXjGVDmZlHFz8+QO
				S43iTumVhKaI8Fe/8/tgNMGZM+m7Z9N1GA== )
</code></pre>
<p>The DNS server has a single zone config for zone <code>"."</code>. To return the associated <code>DNSKEY</code> record(s) we can query them:</p>
<pre><code class="language-shell">dig @127.0.0.1 -p 2345 . DNSKEY +dnssec +multiline
</code></pre>
<p>The response contains two records in the <code>ANSWERS</code> section:</p>
<pre><code class="language-txt">;; ANSWER SECTION:
.			86400 IN DNSKEY	257 3 8 (
				AwEAAZzIkGf9sTXfFFeHTSNjbw3gr4ESGA5CzPtLKTSW
				8rbEpJw2G+goVFRrIS9ieHUna59TEfBkM/8WQ/MVkQQD
				pTTP2Rqg/E0aHEBQ2xbQVIveYXcU9absPn+CPjM3+gq0
				9bv9CDzxsa0yl9B7xbeAM9V8zXqtXfFaQ3plSUs9Wtqo
				nu/mJwEOu8YMiu9K0eZ+Gju1amobaOBXkOwCro7o8wae
				MIC0vFjC/ghfEmFAK1V3TFZw/jQXYWG4I6BdULiiMeLL
				R6ESPCXMRjBcMiCIPy5WOzQ4iAjpSkLEHqrtc9EwnUCT
				C0tmihZPZh3dyy7TgB3YTaHw8KEQhnDmdfjPZpc=
				) ; KSK; alg = RSASHA256 ; key id = 57797
.			86400 IN RRSIG DNSKEY 8 0 86400 (
				20251020134506 20241021134506 57797 .
				Q4CeL96V2NDBJI6jF3wjjLUYrW/jGjOgTuT3D8mRFwPy
				0b6suHmIy+1XPSGgYMAu1bpyVUxcpvXSE7DMIO/eYB/E
				nA5ArjcuOpKIzN+m75pLOZXb204dD5DptBhgjn04zTDB
				ML1rzK5acjp2Lcbo3X5lFABCXpy4diQDZhfCupNVA5JV
				mVD2nJ+eXHQXovB1cYyv5/w+1oK/ojZ1BZbMjUBIQjlH
				hisc8b5Y+V8fDehau3hIOuSrosJb15ST9J7YNndkt5kT
				1nSbAocX3AFWuZEVqwhbou45UAb2NfuvPlbZT5lHReWQ
				5E+1JULfak+HDz/blHyBPzALYrOEn0s7MQ== )
</code></pre>
<p>One is the <code>DNSKEY</code> (KSK) and the other the associated <code>RRSIG</code> for that <code>DNSKEY</code> record. Nearly all signed records
have an associated <code>RRSIG</code> record to describe their signature.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../hickory/installation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../hickory/recursive_resolver.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../hickory/installation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../hickory/recursive_resolver.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
